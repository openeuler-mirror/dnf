From 1d1b389a965f8354a18d64d0cea3a8881f658cdf Mon Sep 17 00:00:00 2001
From: root <root@localhost.localdomain>
Date: Sat, 21 Dec 2019 21:48:47 +0800
Subject: [PATCH] backport-automatic-Fix-the-systemd-ordering-loop-RhBug-163648

Signed-off-by: root <root@localhost.localdomain>
---
 etc/systemd/dnf-automatic-download.service   | 1 +
 etc/systemd/dnf-automatic-download.timer     | 3 +--
 etc/systemd/dnf-automatic-install.service    | 1 +
 etc/systemd/dnf-automatic-install.timer      | 3 +--
 etc/systemd/dnf-automatic-notifyonly.service | 1 +
 etc/systemd/dnf-automatic-notifyonly.timer   | 3 +--
 etc/systemd/dnf-automatic.service            | 1 +
 etc/systemd/dnf-automatic.timer              | 3 ++-
 8 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/etc/systemd/dnf-automatic-download.service b/etc/systemd/dnf-automatic-download.service
index 962a0a2..b60e6b7 100644
--- a/etc/systemd/dnf-automatic-download.service
+++ b/etc/systemd/dnf-automatic-download.service
@@ -2,6 +2,7 @@
 Description=dnf automatic download updates
 # See comment in dnf-makecache.service
 ConditionPathExists=!/run/ostree-booted
+After=network-online.target
 
 [Service]
 Type=oneshot
diff --git a/etc/systemd/dnf-automatic-download.timer b/etc/systemd/dnf-automatic-download.timer
index 3cad73d..bcb145c 100644
--- a/etc/systemd/dnf-automatic-download.timer
+++ b/etc/systemd/dnf-automatic-download.timer
@@ -3,11 +3,10 @@ Description=dnf-automatic-download timer
 # See comment in dnf-makecache.service
 ConditionPathExists=!/run/ostree-booted
 Wants=network-online.target
-After=network-online.target
 
 [Timer]
 OnBootSec=1h
 OnUnitInactiveSec=1d
 
 [Install]
-WantedBy=basic.target
+WantedBy=multi-user.target
diff --git a/etc/systemd/dnf-automatic-install.service b/etc/systemd/dnf-automatic-install.service
index 2dbf954..58e256a 100644
--- a/etc/systemd/dnf-automatic-install.service
+++ b/etc/systemd/dnf-automatic-install.service
@@ -2,6 +2,7 @@
 Description=dnf automatic install updates
 # See comment in dnf-makecache.service
 ConditionPathExists=!/run/ostree-booted
+After=network-online.target
 
 [Service]
 Type=oneshot
diff --git a/etc/systemd/dnf-automatic-install.timer b/etc/systemd/dnf-automatic-install.timer
index ea13f61..013bfe3 100644
--- a/etc/systemd/dnf-automatic-install.timer
+++ b/etc/systemd/dnf-automatic-install.timer
@@ -3,11 +3,10 @@ Description=dnf-automatic-install timer
 # See comment in dnf-makecache.service
 ConditionPathExists=!/run/ostree-booted
 Wants=network-online.target
-After=network-online.target
 
 [Timer]
 OnBootSec=1h
 OnUnitInactiveSec=1d
 
 [Install]
-WantedBy=basic.target
+WantedBy=multi-user.target
diff --git a/etc/systemd/dnf-automatic-notifyonly.service b/etc/systemd/dnf-automatic-notifyonly.service
index c8a21bc..3324c96 100644
--- a/etc/systemd/dnf-automatic-notifyonly.service
+++ b/etc/systemd/dnf-automatic-notifyonly.service
@@ -2,6 +2,7 @@
 Description=dnf automatic notification of updates
 # See comment in dnf-makecache.service
 ConditionPathExists=!/run/ostree-booted
+After=network-online.target
 
 [Service]
 Type=oneshot
diff --git a/etc/systemd/dnf-automatic-notifyonly.timer b/etc/systemd/dnf-automatic-notifyonly.timer
index 97e5411..45fb0b5 100644
--- a/etc/systemd/dnf-automatic-notifyonly.timer
+++ b/etc/systemd/dnf-automatic-notifyonly.timer
@@ -3,11 +3,10 @@ Description=dnf-automatic-notifyonly timer
 # See comment in dnf-makecache.service
 ConditionPathExists=!/run/ostree-booted
 Wants=network-online.target
-After=network-online.target
 
 [Timer]
 OnBootSec=1h
 OnUnitInactiveSec=1d
 
 [Install]
-WantedBy=basic.target
+WantedBy=multi-user.target
diff --git a/etc/systemd/dnf-automatic.service b/etc/systemd/dnf-automatic.service
index 0b390c8..d49775f 100644
--- a/etc/systemd/dnf-automatic.service
+++ b/etc/systemd/dnf-automatic.service
@@ -2,6 +2,7 @@
 Description=dnf automatic
 # See comment in dnf-makecache.service
 ConditionPathExists=!/run/ostree-booted
+After=network-online.target
 
 [Service]
 Type=oneshot
diff --git a/etc/systemd/dnf-automatic.timer b/etc/systemd/dnf-automatic.timer
index 62f1b70..64d6e92 100644
--- a/etc/systemd/dnf-automatic.timer
+++ b/etc/systemd/dnf-automatic.timer
@@ -2,10 +2,11 @@
 Description=dnf-automatic timer
 # See comment in dnf-makecache.service
 ConditionPathExists=!/run/ostree-booted
+Wants=network-online.target
 
 [Timer]
 OnBootSec=1h
 OnUnitInactiveSec=1d
 
 [Install]
-WantedBy=basic.target
+WantedBy=multi-user.target
-- 
2.19.1

